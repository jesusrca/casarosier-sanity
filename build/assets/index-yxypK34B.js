import{r as L,j as u}from"./index-BOQdL6yd.js";function w(e){return e._type==="span"&&"text"in e&&typeof e.text=="string"&&(e.marks===void 0||Array.isArray(e.marks)&&e.marks.every(t=>typeof t=="string"))}function $(e){return typeof e._type=="string"&&e._type[0]!=="@"&&(!("markDefs"in e)||!e.markDefs||Array.isArray(e.markDefs)&&e.markDefs.every(t=>typeof t._key=="string"))&&"children"in e&&Array.isArray(e.children)&&e.children.every(t=>typeof t=="object"&&"_type"in t)}function D(e){return $(e)&&"listItem"in e&&typeof e.listItem=="string"&&(e.level===void 0||typeof e.level=="number")}function M(e){return e._type==="@list"}function P(e){return e._type==="@span"}function O(e){return e._type==="@text"}const v=["strong","em","code","underline","strike-through"];function W(e,t,n){if(!w(e)||!e.marks||!e.marks.length)return[];let r=e.marks.slice(),o={};return r.forEach(l=>{o[l]=1;for(let a=t+1;a<n.length;a++){let c=n[a];if(c&&w(c)&&Array.isArray(c.marks)&&c.marks.indexOf(l)!==-1)o[l]++;else break}}),r.sort((l,a)=>K(o,l,a))}function K(e,t,n){let r=e[t],o=e[n];if(r!==o)return o-r;let l=v.indexOf(t),a=v.indexOf(n);return l===a?t.localeCompare(n):l-a}function C(e){let{children:t}=e,n=e.markDefs??[];if(!t||!t.length)return[];let r=t.map(W),o={_type:"@span",children:[],markType:"<unknown>"},l=[o];for(let a=0;a<t.length;a++){let c=t[a];if(!c)continue;let x=r[a]||[],I=1;if(l.length>1)for(;I<l.length;I++){let i=l[I]?.markKey||"",s=x.indexOf(i);if(s===-1)break;x.splice(s,1)}l=l.slice(0,I);let d=l[l.length-1];if(d){for(let i of x){let s=n?.find(k=>k._key===i),y={_type:"@span",_key:c._key,children:[],markDef:s,markType:s?s._type:i,markKey:i};d.children.push(y),l.push(y),d=y}if(w(c)){let i=c.text.split(`
`);for(let s=i.length;s-- >1;)i.splice(s,0,`
`);d.children=d.children.concat(i.map(s=>({_type:"@text",text:s})))}else d.children=d.children.concat(c)}}return o.children}function U(e,t){let n=[],r;for(let o=0;o<e.length;o++){let l=e[o];if(l){if(!D(l)){n.push(l),r=void 0;continue}if(!r){r=j(l,o,t),n.push(r);continue}if(F(l,r)){r.children.push(l);continue}if((l.level||1)>r.level){let a=j(l,o,t);if(t==="html"){let c=r.children[r.children.length-1],x={...c,children:[...c.children,a]};r.children[r.children.length-1]=x}else r.children.push(a);r=a;continue}if((l.level||1)<r.level){let a=n[n.length-1],c=a&&b(a,l);if(c){r=c,r.children.push(l);continue}r=j(l,o,t),n.push(r);continue}if(l.listItem!==r.listItem){let a=n[n.length-1],c=a&&b(a,{level:l.level||1});if(c&&c.listItem===l.listItem){r=c,r.children.push(l);continue}else{r=j(l,o,t),n.push(r);continue}}console.warn("Unknown state encountered for block",l),n.push(l)}}return n}function F(e,t){return(e.level||1)===t.level&&e.listItem===t.listItem}function j(e,t,n){return{_type:"@list",_key:`${e._key||`${t}`}-parent`,mode:n,level:e.level||1,listItem:e.listItem,children:[e]}}function b(e,t){let n=t.level||1,r=t.listItem||"normal",o=typeof t.listItem=="string";if(M(e)&&(e.level||1)===n&&o&&(e.listItem||"normal")===r)return e;if(!("children"in e))return;let l=e.children[e.children.length-1];return l&&!w(l)?b(l,t):void 0}function A(e){let t="";return e.children.forEach(n=>{O(n)?t+=n.text:P(n)&&(t+=A(n))}),t}const q="html",H={number:({children:e})=>u.jsx("ol",{children:e}),bullet:({children:e})=>u.jsx("ul",{children:e})},R=({children:e})=>u.jsx("li",{children:e}),z=({children:e,value:t})=>u.jsx("a",{href:t?.href,children:e}),V={textDecoration:"underline"},G={em:({children:e})=>u.jsx("em",{children:e}),strong:({children:e})=>u.jsx("strong",{children:e}),code:({children:e})=>u.jsx("code",{children:e}),underline:({children:e})=>u.jsx("span",{style:V,children:e}),"strike-through":({children:e})=>u.jsx("del",{children:e}),link:z},g=(e,t)=>`[@portabletext/react] Unknown ${e}, specify a component for it in the \`components.${t}\` prop`,N=e=>g(`block type "${e}"`,"types"),J=e=>g(`mark type "${e}"`,"marks"),Q=e=>g(`block style "${e}"`,"block"),X=e=>g(`list style "${e}"`,"list"),Y=e=>g(`list item style "${e}"`,"listItem");function Z(e){console.warn(e)}const ee={display:"none"},S={types:{},block:{normal:({children:e})=>u.jsx("p",{children:e}),blockquote:({children:e})=>u.jsx("blockquote",{children:e}),h1:({children:e})=>u.jsx("h1",{children:e}),h2:({children:e})=>u.jsx("h2",{children:e}),h3:({children:e})=>u.jsx("h3",{children:e}),h4:({children:e})=>u.jsx("h4",{children:e}),h5:({children:e})=>u.jsx("h5",{children:e}),h6:({children:e})=>u.jsx("h6",{children:e})},marks:G,list:H,listItem:R,hardBreak:()=>u.jsx("br",{}),unknownType:({value:e,isInline:t})=>{let n=N(e._type);return u.jsx(t?"span":"div",{style:ee,children:n})},unknownMark:({markType:e,children:t})=>u.jsx("span",{className:`unknown__pt__mark__${e}`,children:t}),unknownList:({children:e})=>u.jsx("ul",{children:e}),unknownListItem:({children:e})=>u.jsx("li",{children:e}),unknownBlockStyle:({children:e})=>u.jsx("p",{children:e})};function te(e,t){let{block:n,list:r,listItem:o,marks:l,types:a,...c}=t;return{...e,block:_(e,t,"block"),list:_(e,t,"list"),listItem:_(e,t,"listItem"),marks:_(e,t,"marks"),types:_(e,t,"types"),...c}}function _(e,t,n){let r=t[n],o=e[n];return typeof r=="function"||r&&typeof o=="function"?r:r?{...o,...r}:o}function ie({value:e,components:t,listNestingMode:n,onMissingComponent:r=Z}){let o=r||le,l=U(Array.isArray(e)?e:[e],n||q),a=L.useMemo(()=>t?te(S,t):S,[t]),c=L.useMemo(()=>ne(a,o),[a,o]);return u.jsx(u.Fragment,{children:l.map((x,I)=>c({node:x,index:I,isInline:!1,renderNode:c}))})}const ne=(e,t)=>{function n(i){let{node:s,index:y,isInline:k}=i,f=s._key||`node-${y}`;return M(s)?l(s,y,f):D(s)?o(s,y,f):P(s)?a(s,y,f):r(s)?d(s,y,f,k):$(s)?c(s,y,f,k):O(s)?x(s,f):I(s,y,f,k)}function r(i){return i._type in e.types}function o(i,s,y){let k=B({node:i,index:s,isInline:!1,renderNode:n}),f=e.listItem,p=(typeof f=="function"?f:f[i.listItem])||e.unknownListItem;if(p===e.unknownListItem){let m=i.listItem||"bullet";t(Y(m),{type:m,nodeType:"listItemStyle"})}let h=k.children;if(i.style&&i.style!=="normal"){let{listItem:m,...T}=i;h=n({node:T,index:s,isInline:!1})}return u.jsx(p,{value:i,index:s,isInline:!1,renderNode:n,children:h},y)}function l(i,s,y){let k=i.children.map((h,m)=>n({node:h._key?h:{...h,_key:`li-${s}-${m}`},index:m,isInline:!1})),f=e.list,p=(typeof f=="function"?f:f[i.listItem])||e.unknownList;if(p===e.unknownList){let h=i.listItem||"bullet";t(X(h),{nodeType:"listStyle",type:h})}return u.jsx(p,{value:i,index:s,isInline:!1,renderNode:n,children:k},y)}function a(i,s,y){let{markDef:k,markType:f,markKey:p}=i,h=e.marks[f]||e.unknownMark,m=i.children.map((T,E)=>n({node:T,index:E,isInline:!0}));return h===e.unknownMark&&t(J(f),{nodeType:"mark",type:f}),u.jsx(h,{text:A(i),value:k,markType:f,markKey:p,renderNode:n,children:m},y)}function c(i,s,y,k){let{_key:f,...p}=B({node:i,index:s,isInline:k,renderNode:n}),h=p.node.style||"normal",m=(typeof e.block=="function"?e.block:e.block[h])||e.unknownBlockStyle;return m===e.unknownBlockStyle&&t(Q(h),{nodeType:"blockStyle",type:h}),u.jsx(m,{...p,value:p.node,renderNode:n},y)}function x(i,s){if(i.text===`
`){let y=e.hardBreak;return y?u.jsx(y,{},s):`
`}return i.text}function I(i,s,y,k){let f={value:i,isInline:k,index:s,renderNode:n};t(N(i._type),{nodeType:"block",type:i._type});let p=e.unknownType;return u.jsx(p,{...f},y)}function d(i,s,y,k){let f={value:i,isInline:k,index:s,renderNode:n},p=e.types[i._type];return p?u.jsx(p,{...f},y):null}return n};function B(e){let{node:t,index:n,isInline:r,renderNode:o}=e,l=C(t).map((a,c)=>o({node:a,isInline:!0,index:c,renderNode:o}));return{_key:t._key||`block-${n}`,children:l,index:n,isInline:r,node:t}}function le(){}export{ie as P};
